<!DOCTYPE html>
<html lang="es">

<head>
    <title>{% block title %}{% endblock %}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="keywords" content="">
    <meta name="author" content="Phoenixcoded" />
    <!-- Favicon icon -->
    <link rel="icon" href="{{ url_for('static', filename='assets/images/favicon.ico') }}" type="image/x-icon">

    <!-- vendor css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">

    <script>
        var userData = JSON.parse(localStorage.getItem('userData'));

        function vaciarUserData() {
            localStorage.removeItem('userData');
        }

        if (userData == null) {
            window.location.href = '/login';
        }

    </script>

</head>

<body class="">
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->

    <!-- [ navigation menu ] start -->
    <nav class="pcoded-navbar  ">
        <div class="navbar-wrapper  ">
            <div class="navbar-content scroll-div ">

                <div class="">
                    <div class="main-menu-header">
                        <div class="user-details">
                            <span id="nombreUsuarioVista"></span>
                            <div id="more-details"><span id="rolUsuarioVista"></span><i class="fa fa-chevron-down m-l-5"></i></div>
                        </div>
                    </div>
                    <div class="collapse" id="nav-user-link">
                        <ul class="list-unstyled">
                            <li class="list-group-item"><a id="botonCerrarSesion"><i
                                        class="feather icon-log-out m-r-5"></i>Cerrar Sesion</a></li>
                        </ul>
                    </div>
                </div>

                <ul class="nav pcoded-inner-navbar ">
                    <li class="nav-item pcoded-menu-caption">
                        <label>Navegacion</label>
                    </li>
                    <li class="nav-item">
                        <a href="/" class="nav-link "><span class="pcoded-micon"><i
                                    class="feather icon-repeat"></i></span><span
                                class="pcoded-mtext" >Ventas</span></a>
                    </li>
                    <li class="nav-item">
                        <a href="/proveedores" class="nav-link "><span class="pcoded-micon"><i
                                    class="feather icon-users"></i></span><span
                                class="pcoded-mtext" >Proveedores</span></a>
                    </li>
                    <li id="empleados" class="nav-item">
                        <a href="/empleado" class="nav-link "><span class="pcoded-micon"><i
                                    class="feather icon-users"></i></span><span
                                class="pcoded-mtext" >Empleados</span></a>
                    </li>
                    <li class="nav-item pcoded-hasmenu">
                        <a href="#!" class="nav-link "><span class="pcoded-micon"><i
                                    class="feather icon-layout"></i></span><span
                                class="pcoded-mtext">Inventario</span></a>
                        <ul class="pcoded-submenu">
                            <li><a id="lote"href="/lote"><i class="feather icon-grid"></i> Lote</a></li>
                            <li><a  href="/categoria"><i class="feather icon-grid"></i> Categoria</a></li>
                            <li><a href="/productos"><i class="feather icon-shopping-cart"></i> Productos</a></li>
                        </ul>
                    </li>
                    <li class="nav-item pcoded-menu-caption">
                        <label>Reportes &amp; Alertas</label>
                    </li>
                    <li id="reportes" class="nav-item">
                        <a href="/reportes" class="nav-link "><span class="pcoded-micon"><i
                                    class="feather icon-file-text"></i></span><span
                                class="pcoded-mtext" >Reportes</span></a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
    <!-- [ navigation menu ] end -->

    <!-- [ Header ] start -->
    <header class="navbar pcoded-header navbar-expand-lg navbar-light header-dark">


        <div class="m-header">
            <a class="mobile-menu" id="mobile-collapse" href="#!"><span></span></a>
            <a href="#!" class="b-brand">
                <!-- ========   change your logo hear   ============ -->
                <!--<img src="{{ url_for('static', filename='assets/images/auth/unnamed.png') }}" alt="" class="logo">-->
                <!--src="{{ url_for('static', filename='assets/images/auth/unnamed.png') }}" alt="" class="logo-thumb">-->
            </a>
            <a href="#!" class="mob-toggler">
                <i class="feather icon-more-vertical"></i>
            </a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ml-auto">
                <li>
                    <div class="dropdown">
                        <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                            <i class="icon feather icon-bell"></i>
                            <span class="badge badge-pill badge-danger">5</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right notification">
                            <div class="noti-head">
                                <h6 class="d-inline-block m-b-0">Notificaciones</h6>
                                <div class="float-right">
                                    <a href="#!">limpiar todo</a>
                                </div>
                            </div>
                            <ul class="noti-body">
                                <li class="n-title">
                                    <p class="m-b-0">NUEVO</p>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius"
                                            src="{{ url_for('static', filename='/assets/images/user/avatar-1.jpg') }}"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Alerta de Stock</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>5 min</span></p>
                                            <p>Te queda poca yuca</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="n-title">
                                    <p class="m-b-0">RECIENTES</p>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius"
                                            src="{{ url_for('static', filename='/assets/images/user/avatar-2.jpg') }}"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Alerta de caducidad</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>10 min</span></p>
                                            <p>Es mejor que prepares pulpas de fresa</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius"
                                            src="{{ url_for('static', filename='/assets/images/user/avatar-1.jpg') }}"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Alerta de caducidad</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>12 min</span></p>
                                            <p>La papa pronto se va a daÃ±ar</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="notification">
                                    <div class="media">
                                        <img class="img-radius"
                                            src="{{ url_for('static', filename='/assets/images/user/avatar-2.jpg') }}"
                                            alt="Generic placeholder image">
                                        <div class="media-body">
                                            <p><strong>Alerta de stock</strong><span class="n-time text-muted"><i
                                                        class="icon feather icon-clock m-r-10"></i>30 min</span></p>
                                            <p>Compra mas manzanas</p>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                            <div class="noti-footer">
                                <a href="#!">mirar todo</a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <!-- [ Header ] end -->

    {% block mainContent %}
    <!-- AquÃ­ irÃ¡ el contenido especÃ­fico de cada pÃ¡gina -->
    {% endblock %}

    <!-- Required Js -->
    <script src="{{ url_for('static', filename='assets/js/vendor-all.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/plugins/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/pcoded.min.js') }}"></script>

    <!-- Apex Chart -->
    <script src="{{ url_for('static', filename='assets/js/plugins/apexcharts.min.js') }}"></script>


    <!-- custom-chart js -->
    <script src="{{ url_for('static', filename='assets/js/pages/dashboard-main.js') }}"></script>
</body>

<!-- [ Footer ] start -->
<footer class="footer bg-dark text-white mt-5">
    <div class="container">
        <div class="row">
            <!-- SecciÃ³n de InformaciÃ³n de la Empresa -->
            <div class="col-md-4">
                <h5>Sobre Nosotros</h5>
                <p>Somos una empresa comprometida con la optimizaciÃ³n de procesos y la innovaciÃ³n tecnolÃ³gica para el
                    mejoramiento de la gestiÃ³n empresarial.</p>
            </div>

            <!-- SecciÃ³n de Enlaces RÃ¡pidos -->
            <div class="col-md-4">
                <h5>Enlaces RÃ¡pidos</h5>
                <ul class="list-unstyled">
                    <li><a href="index.html" class="text-white">Inicio</a></li>
                    <li><a href="view_proveedores.html" class="text-white">Proveedores</a></li>
                    <li><a href="view_lote.html" class="text-white">Lotes</a></li>
                    <li><a href="view_productos.html" class="text-white">Productos</a></li>
                    <li><a href="contacto.html" class="text-white">Contacto</a></li>
                </ul>
            </div>

            <!-- SecciÃ³n de Redes Sociales -->
            <div class="col-md-4">
                <h5>ContÃ¡ctanos</h5>
                <p>Email: info@tuempresa.com</p>
                <p>TelÃ©fono: +57 312 341 8972</p>
                <div class="social-icons">
                    <a href="#" class="text-white mr-3"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-white mr-3"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-white mr-3"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>

        <hr class="bg-white">

        <!-- SecciÃ³n de Copyright -->
        <div class="text-center py-3">
            <p>&copy; 2024 Tu Empresa. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>
<!-- [ Footer ] end -->
<script>
    // Variable para controlar si ya se cargó el listado de notificaciones
    let notifyLoaded = null;

    // Función para cargar notificaciones desde el backend
    async function cargarNotificaciones() {
        if (notifyLoaded === null) {
            try {
                const response = await fetch('/notificacion/notify');
                if (!response.ok) {
                    throw new Error('Error al cargar las notificaciones');
                }

                const data = await response.json(); // Verifica que la respuesta sea JSON
                console.log('Respuesta del servidor:', data); // Ver la respuesta completa

                // Verificamos si el objeto tiene la clave 'mensajes' y es un array
                if (data.hasOwnProperty('mensajes') && Array.isArray(data.mensajes)) {
                    const mensajes = data.mensajes; // Obtener el array de mensajes
                    console.log('Mensajes:', mensajes); // Ver los mensajes

                    const notificacionesContainer = document.querySelector('.noti-body');
                    notificacionesContainer.innerHTML = ''; // Limpiar las notificaciones previas

                    // Recorrer el array de mensajes y crear una notificación por cada uno
                    mensajes.forEach((mensaje) => {
                        console.log(`Mensaje: ${mensaje}`); // Ver cada mensaje

                        // Crear el elemento <li> para cada notificación
                        const li = document.createElement('li');
                        li.className = 'notification';
                        li.innerHTML = `
                            <div class="media">
                                <div class="media-body">
                                    <p><strong>Notificación</strong><span class="n-time text-muted"><i
                                                class="icon feather icon-clock m-r-10"></i>Ahora</span></p>
                                    <p>${mensaje}</p>
                                </div>
                            </div>
                        `;
                        // Añadir la notificación a la lista de notificaciones
                        notificacionesContainer.appendChild(li);
                    });
                } else {
                    console.error('La clave "mensajes" no es un array válido');
                }
            } catch (error) {
                console.error('Error al cargar las notificaciones:', error);
            } finally {
                // Cambiar el estado para que no se vuelva a cargar
                notifyLoaded = true;
            }
        }
    }

    // Ejecutar al cargar el DOM
    document.addEventListener('DOMContentLoaded', cargarNotificaciones);
</script>


<script>
    document.getElementById("botonCerrarSesion").addEventListener("click", function (event) {
        event.preventDefault(); // Evita que el enlace siga su comportamiento por defecto
        vaciarUserData();
        window.location.href = '/login';
    });

    document.getElementById("nombreUsuarioVista").innerHTML = userData["nombre"];
    document.getElementById("rolUsuarioVista").innerHTML = userData["rol"];

    document.addEventListener('DOMContentLoaded', function () {
        const empleados = document.getElementById('empleados');
        const reportes = document.getElementById('reportes');
        const Lote = document.getElementById('lote');

        if (userData['rol'] === 'administrador') {
            empleados.style.display = 'inline-block';
            reportes.style.display = 'inline-block';
            Lote.style.display = 'inline-block';
        } else if (userData['rol'] === 'empleado') {
            empleados.style.display = 'none';
            reportes.style.display = 'none';
            Lote.style.display = 'none';
        }
    });

</script>

</html>